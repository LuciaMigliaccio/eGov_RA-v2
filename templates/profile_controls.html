{% extends 'base.html' %}

{% load get_item from template_filters %}
{% block content %}

    <h1>Selection of controls:</h1>
    <p style="font-family: 'Times New Roman';font-size: medium">
        Select the subcategory within the controls you have implemented for each one of them
    </p>
    <form method="POST" name = "formname" action="{% url 'save_profile_controls' profile %}">
        {% csrf_token %}
        <table class="table">
        <thead>
            <tr>
                <th>Subcategory </th>
                <th>Choose</th>
                <th>Control</th>
            </tr>
        </thead>

        <tbody>
            <tr>
                <td>
                    {% for subcategory in subcategory_dict %}
                        <tr>
                            <td>{{ subcategory.name}}: {{ subcategory.description}} </td>
                            <td>
                                 <a href="" style="color: black" data-toggle="modal"
                                       data-target="#ControlChoice{{ subcategory.id }}">
                                        Choose control for {{ subcategory.name }}
                                    </a>
                                    <div class="modal" tabindex="-1" id="ControlChoice{{ subcategory.id }}">
                                        <div class="modal-dialog modal-lg" style="width:100%">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title">{{ subcategory.name }} control choice</h1>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Standard</th>
                                                                    <th>Family</th>
                                                                    <th>Control</th>
                                                                </tr>
                                                            </thead>

                                                            <tbody id="tb">
                                                            <tr>
                                                                <td>
                                                                    <select id="standard{{ subcategory.id }}" onchange="changestandard('{{ subcategory.id }}')"  name="stdlist" class="form-control" style="width: 150px !important; min-width: 150px; max-width: 150px;" required>
                                                                        <option value="" selected disabled hidden>Choose here</option>
                                                                        {% for value in standard_list %}
                                                                        <option class="{{ value.id }}">{{ value}}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <select  id="family{{ subcategory.id }}" onchange="changefamily('{{ subcategory.id }}')" name="famlist" class="form-control" style="width: 150px !important; min-width: 150px; max-width: 150px;" required>
                                                                        <option value="" selected disabled hidden>Choose here</option>
                                                                        {% for value in family_list %}
                                                                        <option id="{{ value.id }}" class="{{ value.framework_id_id }}">{{ value}}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <select id="contr{{ subcategory.id }}" name="controls" class="form-control" style="width: 150px !important; min-width: 150px; max-width: 150px;" required>
                                                                         <option value="" selected disabled hidden>Choose here</option>
                                                                        {% for value in controls_list %}
                                                                        <option id="{{ value.family_id }}">{{ value}}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </td>


                                                            </tr>
                                                            </tbody>
                                                        </table>

                                                    </div>
                                                <div class="modal-footer">
                                                    <input type='button' onclick="content('{{ subcategory.id }}')" value='copy content'>
                                                    <button type="button"  class="btn btn-secondary"
                                                            data-dismiss="modal">
                                                        Close
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </td>
                            <td>
                                <input type="text" id="text{{subcategory.id}}" name="controls">
                            </td>
                        </tr>
                    {% endfor %}
                </td>
            </tr>
        </tr>
        </tbody>
     </table>
     <button type="submit" class="btn btn-primary btn-sm">Save controls</button>
    </form>



    <script>
        content=function(id){

            var prevtext = $('#text'+id).prop('value')
            var testo=  $('#contr'+id+' option').filter(':selected').text() + ";"
            var text = $('#text'+id).prop('value',prevtext + testo)

        }

    </script>


    <script>


         changestandard= function(id){
           var levelClass= $('#standard'+id).find('option:selected').attr('class');
           $('#family'+id+' option').each(function(){
              var self= $(this);
              if(self.hasClass(levelClass) || typeof(levelClass) == "undefined"){
                  self.show();
              }else  {
                  self.hide();
              }
           });
        }

        changefamily=function(id){

            var levelClass= $('#family'+id).find('option:selected').prop('id');
           $('#contr'+id+' option').each(function(){
              var self= $(this);

              if(self.prop('id') == levelClass){
                  self.show();
              }else  {
                  self.hide();
              }
           });
        }


    </script>



{% endblock %}